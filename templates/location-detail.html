{% extends "base.html" %}
{# Title #}
{% block title %}{{ title }}{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', path='css/location-detail.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='css/slider.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='css/rating.css') }}">
{% endblock %}
{% block content %}



    <div class="container">
        <div class="float-slider">
            <div class="location-slider">
                <div class="simple-slider">
                    {% for photo in location['photos'] %}
                        <div class="slide {% if loop.first %}active{% endif %}">
                            {% if photo %}
                                <img src="/{{ photo['url'] }}" alt="{{ photo['name'] }}">
                            {% else %}
                                <img src="{{ url_for('static', path='img/web/noImage.webp') }}" alt="Bez fotky">
                            {% endif %}
                        </div>
                    {% endfor %}
                    {% if location['photos'] | length > 1 %}
                        <button type="button" class="slider-btn prev" onclick="changeSlide(-1)">❮</button>
                        <button type="button" class="slider-btn next" onclick="changeSlide(1)">❯</button>
                    {% endif %}
                </div>
                <div class="under-slider-buttons">
                    <!--Add/Remove favorite-->
                    {% if user_status.is_favorite %}
                        <form action="/locations/{{ location["id"] }}/favorite/remove" method="post">
                            <button type="submit" class="under-slider-button remove">Oblíbené (Odebrat) <i
                                    class="fa-solid fa-xmark"></i></button>
                        </form>
                    {% else %}
                        <form action="/locations/{{ location["id"] }}/favorite/add" method="post">
                            <button type="submit" class="under-slider-button">Přidat do oblíbených <i
                                    class="fa-solid fa-star"></i></button>
                        </form>
                    {% endif %}
                    <!--Add/Remove visited-->
                    {% if user_status.is_visited %}
                        <form action="/locations/{{ location["id"] }}/visited/remove" method="post">
                            <button type="submit" class="under-slider-button remove">Navštíveno (Odebrat) <i
                                    class="fa-solid fa-xmark"></i></button>
                        </form>
                    {% else %}
                        <form action="/locations/{{ location["id"] }}/visited/add" method="post">
                            <button type="submit" class="under-slider-button">Přidat do navštívených <i
                                    class="fa-solid fa-globe"></i></button>
                        </form>
                    {% endif %}
                    {# User rating #}
                    {% if request.session.get("user") %}
                        <div class="user-rating-section">
                            <h4>
                                {% if my_rating > 0 %}
                                    Vaše hodnocení:
                                {% else %}
                                    Ohodnoť tuto lokaci:
                                {% endif %}
                            </h4>
                            <form action="/locations/{{ location.id }}/rate" method="post">
                                <div class="star-buttons rating-reverse">
                                    {% for i in range(5, 0, -1) %}
                                        <button type="submit" name="stars" value="{{ i }}"
                                                class="star-btn"
                                                title="Dát {{ i }} hvězd">
                                            <i class="fa-solid fa-star {% if i <= (my_rating or 0)|int %}active-star{% endif %}"></i>
                                        </button>
                                    {% endfor %}
                                </div>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="heading-box">
            <h1>{{ title }}</h1>
            {% if request.session.get("user") and request.session.user.role <= 2 %}
                <div class="heading-buttons">
                    <a href="/locations/{{ location.id }}/edit_location">
                        <button type="button" title="Upravit"><i class="fa-solid fa-pencil"></i></button>
                    </a>
                    <form action="/locations/{{ location.id }}/delete" method="post"
                          onsubmit="return confirm('Opravdu chcete smazat tuto lokaci?');">
                        <button type="submit" title="Smazat" class="delete-btn"><i class="fa-solid fa-trash"></i>
                        </button>
                    </form>
                </div>
            {% endif %}
        </div>
        {# Average rating #}
        <div>
            <div class="rating-stars" title="Průměrné hodnocení: {{ (location['avg_rating'] or 0) | round(1) }}">
                {% set active_stars = location['avg_rating'] | int %}
                {% set inactive_stars = 5 - active_stars %}
                {% for i in range(active_stars) %}
                    <i class="fa-solid fa-star star-active"></i>
                {% endfor %}
                {% for i in range(inactive_stars) %}
                    <i class="fa-solid fa-star star-inactive"></i>
                {% endfor %}
                <span class="rating-value">
                {% if location['avg_rating'] %}
                    {{ location['avg_rating'] | round(1) }}
                {% else %}
                    0.0
                {% endif %}
                </span>
            </div>
            {{ location['date_location_added'] }}<br>
        </div>

        <div>
            {{ location['description']  | safe }}
        </div>

        {# Komentáře #}
        <div class="comment-section">
            <h2>Komentáře</h2>

            {% if request.session.get("user") %}
                <div class="add-comment-section">
                    <h3>Přidat komentář</h3>
                    <form method="post" action="/locations/{{ location.id }}/add_comment" enctype="multipart/form-data">
                        <div>
                            <label for="comment_text">Komentář:</label><br>
                            <textarea id="comment_text" name="comment_text"></textarea>
                        </div>
                        <br>
                        <button type="submit">Okomentovat</button>
                    </form>
                </div>
            {% endif %}

            {% for com in comments %}
                <div class="comment">
                    <div class="comment-info">
                        <div class="comment-author">
                            {{ com["author"] }}
                        </div>
                        <div class="comment-date">
                            {{ com["date"] }}
                        </div>
                    </div>
                    <div class="comment-text">
                        {{ com["text"] | safe }}
                        {% if request.session.get("user") %}
                            {% if com["user_id"] == request.session.user.id or request.session.user.role <= 2 %}
                                <form method="post" action="/locations/{{ location.id }}/delete_comment"
                                      onsubmit="return confirm('Opravdu chceš smazat tento komentář?');">
                                    <input type="hidden" name="comment_id" value="{{ com['id'] }}">
                                    <button type="submit" title="Smazat komentář" class="comment-delete-button">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            {% endfor %}

        </div>
    </div>
    <script src="{{ url_for('static', path='js/slider.js') }}"></script>
{% endblock %}